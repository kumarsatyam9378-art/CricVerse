<script type="module">
    import { players } from './data.js';
    import { Auth } from './auth.js';

    const loginBtn = document.getElementById('google-login-btn');

    // Page load hote hi check karo login hoke aaya hai kya
    window.addEventListener('load', async () => {
        const user = await Auth.checkRedirect();
        if (user) handleLoginSuccess(user);
    });

    loginBtn.onclick = async () => {
        loginBtn.innerHTML = "Connecting...";
        loginBtn.disabled = true;
        
        try {
            const user = await Auth.login();
            if (user) handleLoginSuccess(user);
        } catch (err) {
            // YE LINE SABSE IMPORTANT HAI - ERROR CODE DIKHAYEGI
            alert("ASLI ERROR: " + err.code + "\nMESSAGE: " + err.message);
            loginBtn.innerHTML = "SIGN IN WITH GOOGLE";
            loginBtn.disabled = false;
        }
    };

    function handleLoginSuccess(user) {
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('lobby-section').classList.remove('hidden');
        document.getElementById('user-name').innerText = user.displayName;
        document.getElementById('user-avatar').src = user.photoURL;
        document.getElementById('user-avatar').style.display = "block";
        localStorage.setItem('CV_AuthToken', user.accessToken);
        renderPlayers(); // Apka purana function
    }
</script>
